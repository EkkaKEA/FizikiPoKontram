Перем  i;
Перем  j;

//_____________________________________________________________________________


Функция ВыделитьСлово(ИсходнаяСтрока)
	
	Буфер = СокрЛ(ИсходнаяСтрока);
	ПозицияПослПробела = Найти(Буфер, " ");

	Если ПозицияПослПробела = 0 Тогда
		ИсходнаяСтрока = "";
		Возврат Буфер;
	КонецЕсли;
	
	ВыделенноеСлово = СокрЛП(Лев(Буфер, ПозицияПослПробела));
	ИсходнаяСтрока = Сред(ИсходнаяСтрока, ПозицияПослПробела + 1);
	
	Возврат ВыделенноеСлово;
	
КонецФункции

Функция ПолучитьДатуИзСтроки(Стр) 

         Д = Дата("00010101000000");

         Если ПустаяСтрока(Стр) Тогда
             Возврат Д;
         КонецЕсли;

         Если Найти(Стр,".") > 0 Тогда

             Если Найти(Стр,":") > 0 И Найти(Стр," ") > 0 Тогда 
                 М = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Стр," ");
                 Возврат ПолучитьДатуИзСтроки(М[0]);
             КонецЕсли;

             М = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Стр,".");

         ИначеЕсли Найти(Стр,"/")>0 Тогда

             М = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Стр,"/");

         ИначеЕсли Найти(Стр,",")>0 Тогда

             М = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Стр,",");

         ИначеЕсли Найти(Стр,"-")>0 Тогда

             М = ОбщегоНазначения.РазложитьСтрокуВМассивПодстрок(Стр,"-");

         КонецЕсли; 

         Попытка

             Если М.Количество() = 3 Тогда //"01.02.13" или "01.02.2013"
                 Год = ?(СтрДлина(М[2]) = 2,2000 + М[2],М[2]);
                 Д = Дата(Год,М[1],М[0]);
             ИначеЕсли М.Количество() = 2 Тогда //"02.13" или "02.2013";
                 Год = ?(СтрДлина(М[1]) = 2,2000 + М[1],М[1]);
                 Д = Дата(Год,М[0],1);
             КонецЕсли;

         Исключение
         КонецПопытки; 

         Возврат Д; 

     КонецФункции

Функция НайтиЧислоВСтроке(Строка) 


   положение = 0;

   Для Индекс = 1 По СтрДлина(Строка) Цикл
   
      Символ = Сред(Строка, Индекс, 1); // Перебираем все сиволы из нашей строки

      Если КодСимвола(Символ) >= 48 И КодСимвола(Символ) <= 57 Тогда // Код нуля - 48, код 9-ки - 57
         положение = Индекс;  Возврат положение
      КонецЕсли;
   
   КонецЦикла;

   Возврат положение

КонецФункции

Процедура ЗаписатьДокументВРегистр(Ссылка, серия, номер, датаВ, кем, кодП) Экспорт
	
	ДокСрез = РегистрыСведений.ПаспортныеДанныеФизЛиц.ПолучитьПоследнее(,Новый Структура("ФизЛицо",Ссылка));
	ВидДокументаУдостоверяющегоЛичность=Справочники.ДокументыУдостоверяющиеЛичность.НайтиПоНаименованию("Паспорт");

	
	СтрокаСреза = ДокСрез.ДокументСерия + ДокСрез.ДокументНомер + ДокСрез.ДокументКодПодразделения;
	
	Если СтрокаСреза <> (серия + номер + кодП) Тогда
		
		МенеджерЗаписи = РегистрыСведений.ПаспортныеДанныеФизЛиц.СоздатьМенеджерЗаписи();
		
		МенеджерЗаписи.ФизЛицо = Ссылка;
		Если ПустаяСтрока(СтрокаСреза) Тогда
			МенеджерЗаписи.Период = '19800101';
		Иначе
			МенеджерЗаписи.Период = РабочаяДата;
		КонецЕсли;
		
		МенеджерЗаписи.ДокументВид					= ВидДокументаУдостоверяющегоЛичность;
		МенеджерЗаписи.ДокументСерия = серия;
		МенеджерЗаписи.ДокументНомер = номер;
		МенеджерЗаписи.ДокументДатаВыдачи = датаВ;
		МенеджерЗаписи.ДокументКемВыдан = кем;
		МенеджерЗаписи.ДокументКодПодразделения = кодП;
		
		
		МенеджерЗаписи.Записать(Истина);
	КонецЕсли;
	
КонецПроцедуры


Процедура Кнопка1Нажатие(Элемент)
СпрфизЛица = Справочники.ФизическиеЛица;	
ВыборкаСпр = Справочники.Контрагенты.Выбрать(ВыбГруппа,,,);
    
Пока ВыборкаСпр.Следующий() Цикл
       
    ИскомыйОбъект = ВыборкаСпр.ПолучитьОбъект();
	
//ДОКУМЕНТ	
	СерияГрубо="";   НомерГрубо="";   Серия=""; выдангрубо="";
	нашли=0;
	Буфер= ИскомыйОбъект.ДокументУдостоверяющийЛичность;
	Буфер= СтрЗаменить(Буфер,",","");
	Буфер= СокрЛП(СтрЗаменить(Буфер,"паспорт",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,"Паспорт",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,"-",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,"серии",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,"выдан",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,":",""));
	Буфер= СокрЛП(СтрЗаменить(Буфер,"номер","№"));
	
	естьНомерн=Найти(Буфер,"№");
	Если естьНомерн<>0 
		Тогда Сериягрубо= Лев(Буфер,естьНомерн-1);  Нашли=1;
	НомерГрубо  = ВыделитьСлово(СокрЛП(Сред(Буфер,естьНомерн+1)));
	Серия=Прав(СтрЗаменить(Сериягрубо," ",""),4);
	выдангрубо=СокрЛП(Сред(Буфер,Найти(Буфер,номергрубо)+6));
	КонецЕсли;
	
	Если (нашли=0)
		Тогда 
		Сериягрубо= СокрЛП(Лев(Буфер,5));
		Серия=Прав(СтрЗаменить(Сериягрубо," ",""),4);
		НомерГрубо  = ВыделитьСлово(СокрЛП(Сред(Буфер,6)));
		выдангрубо=СокрЛП(Сред(Буфер,Найти(Буфер,номергрубо)+6));
		Нашли=1;
	КонецЕсли;

	СтрокаДата = Сред(выдангрубо,НайтиЧислоВСтроке(выдангрубо),10);
	естьот=лев(выдангрубо,2) ;
	Если естьот="от" Тогда СтрокаДата = Сред(выдангрубо,4,10)КонецЕсли;
	естьтч=сред(выдангрубо,3,1) ;
	Если естьтч="." Тогда СтрокаДата = Сред(выдангрубо,1,10)КонецЕсли;
	датавыдачи=ПолучитьДатуИзСтроки(СтрокаДата);
	
	положениеКода=Найти(Буфер,"код подразделения");
	Если  положениеКода>0 
	Тогда	
	КодПодразделенияДокумента=СокрЛП(Сред(Буфер,положениеКода+17));
	КодПодразделенияДокумента= СокрЛП(СтрЗаменить(КодПодразделенияДокумента,"№",""));
	Иначе 
	КодПодразделенияДокумента="";
	КонецЕсли;

	ВидДокументаУдостоверяющегоЛичность=Справочники.ДокументыУдостоверяющиеЛичность.НайтиПоНаименованию("Паспорт");
	ДатаВыдачиДокумента=ДатаВыдачи;
	КемВыданДокумент=СокрЛП(СтрЗаменить(выдангрубо,КодПодразделенияДокумента,""));
	КемВыданДокумент=СокрЛП(СтрЗаменить(КемВыданДокумент,"код подразделения",""));
	КемВыданДокумент=СокрЛП(СтрЗаменить(КемВыданДокумент,"№",""));
	КемВыданДокумент=СокрЛП(СтрЗаменить(КемВыданДокумент,"от г.",""));
	
	
//<ДОКУМЕНТ	 	





СтрокаНаименования = ИскомыйОбъект.НаименованиеПолное;
Если (пустаястрока(СтрокаНаименования))
	Тогда СтрокаНаименования = ИскомыйОбъект.Наименование;
КонецЕсли;	
СтрокаНаименования= СокрЛП(СтрЗаменить(СтрокаНаименования,"Индивидуальный предприниматель",""));
СтрокаНаименования= СокрЛП(СтрЗаменить(СтрокаНаименования,"глава крестьянского (фермерского) хозяйства",""));

Если (Найти(СтрокаНаименования,"бщество")<>0) Тогда Продолжить; КонецЕсли;

Сообщить( СтрокаНаименования);

СтрокаРазложить=СтрокаНаименования;
НайденнаяСсылка = СпрфизЛица.НайтиПоНаименованию(СтрокаНаименования,,,);

	Фамилия  = ВыделитьСлово(СтрокаРазложить);
	Имя      = ВыделитьСлово(СтрокаРазложить);
	Отчество = ВыделитьСлово(СтрокаРазложить);



Если НайденнаяСсылка = СпрфизЛица.ПустаяСсылка() Тогда
//Если 0 = 1 Тогда	
	
    НовыйОбъект = Справочники.ФизическиеЛица.СоздатьЭлемент();
	НовыйОбъект.Наименование = СтрокаНаименования;
	НовыйОбъект.ИНН = ИскомыйОбъект.ИНН;
	новыйОбъект.Записать();
	Сообщить("///добавили\\\");

НайденнаяСсылка = СпрфизЛица.НайтиПоНаименованию(СтрокаНаименования,,,);
Иначе
    //Сообщить("Нашли.");
КонецЕсли;

    
    Ссылка = НайденнаяСсылка;
	Если (ССылка <>  СпрфизЛица.ПустаяССылка())  
		Тогда
		сообщить("вошли в "+ССылка.ИНН+"/"+ИскомыйОбъект.ИНН);
	РегламентированнаяОтчетность.ЗаписатьДанныеФИОВРегистр(Ссылка, Фамилия, Имя, Отчество);
	ЗаписатьДокументВРегистр(Ссылка, серия, НомерГрубо, ДатаВыдачиДокумента, КемВыданДокумент, КодПодразделенияДокумента);


	
//АДРЕС
адр=УправлениеКонтактнойИнформацией.ПолучитьАдресИзКонтактнойИнформации(ИскомыйОбъект.Ссылка, "Фактический");
//Сообщить( адр);
//<АДРЕС
	
	
	
	НаборИнформации=РегистрыСведений.КонтактнаяИнформация.СоздатьНаборЗаписей();
	УправлениеКонтактнойИнформацией.ПрочитатьКонтактнуюИнформацию(НаборИнформации, ИскомыйОбъект.Ссылка);
	УправлениеКонтактнойИнформацией.ЗаписатьКонтактнуюИнформацию(НаборИнформации, Ссылка, )  ;
//    адрПр=УправлениеКонтактнойИнформацией.ПолучитьАдресИзКонтактнойИнформации(ИскомыйОбъект.Ссылка, "Фактический");
	НаборЗаписей = РегистрыСведений.КонтактнаяИнформация.СоздатьНаборЗаписей();
    НаборЗаписей.Отбор.Объект.Установить(Ссылка);
    НаборЗаписей.Прочитать();
    Для Каждого Запись Из НаборЗаписей Цикл
       // Сообщить(  "[" + Запись.вид + ", " + Запись.вид.код + ", " + Запись.тип + ", " +     Запись.объект + "] " );
     	Запись.вид=справочники.видыКонтактнойИнформации.НайтиПоКоду("00002");
		Запись.Период						= ТекущаяДата();
		попытка
		НаборЗаписей.Записать(Истина);
		исключение
		конецПопытки;
	КонецЦикла;




    КонецЕсли;
КонецЦикла ;
Сообщить("////Закончил\\\\\");
КонецПроцедуры

	


Процедура ВыбПериодНажатие(Элемент)
	НастройкаПериода = Новый НастройкаПериода;
	НастройкаПериода.РедактироватьКакИнтервал = Истина;
	НастройкаПериода.РедактироватьКакПериод = Истина;
	НастройкаПериода.ВариантНастройки = ВариантНастройкиПериода.Период;
	НастройкаПериода.УстановитьПериод(НачПериода, ?(КонПериода='0001-01-01', КонПериода, КонецДня(КонПериода)));
	Если НастройкаПериода.Редактировать() Тогда
		НачПериода = НачалоДня(НастройкаПериода.ПолучитьДатуНачала());
		КонПериода = КонецДня(НастройкаПериода.ПолучитьДатуОкончания());
	КонецЕсли;
	НадписьПериод = "" + ПредставлениеПериода(НачалоДня(НачПериода), КонецДня(КонПериода), "ФП = Истина");


КонецПроцедуры
//


ТекДата = ТекущаяДата();
НачПериода = НачалоДня(НачалоМесяца('20170101'));
КонПериода = КонецДня(НачалоМесяца('20170101'));
НадписьПериод = "" + ПредставлениеПериода(НачалоДня(НачПериода), КонецДня(КонПериода), "ФП = Истина");
